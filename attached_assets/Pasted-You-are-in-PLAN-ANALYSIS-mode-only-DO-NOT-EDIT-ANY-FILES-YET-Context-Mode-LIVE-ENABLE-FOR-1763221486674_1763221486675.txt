You are in PLAN / ANALYSIS mode only. DO NOT EDIT ANY FILES YET.

Context:
- Mode: LIVE
- ENABLE_FORCE_TRADE=1 is set in .env
- Bot has been restarted
- I issued: "Force trade test on ETH/USD"

Result:
- Your response: "⚠️ I cannot confirm the execution status. Please verify your open orders with the 'open' command."
- I checked Kraken manually:
  - No new open orders
  - No new trades
→ Conclusion: The force trade command DID NOT result in a real order on Kraken.

We already fixed llm_agent.py so the LLM WILL call the trading tool. Now the problem is clearly in the BACKEND (commands.py / bracket_order_manager / exchange wrapper). I want a forensic analysis focused ONLY on the force trade path.

────────────────────
STEP 1 – FIND THAT ERROR MESSAGE
────────────────────

1. Search the codebase for the exact text (or closest match):

   "I cannot confirm the execution status"

For every occurrence:
- Show:
  - File path
  - Function name
  - The entire function body where this message is produced or returned
- Explain in 2–3 lines what that function is trying to do logically.

If this message is constructed dynamically (e.g. f-strings), show the full return block.

──────────────────────────
STEP 2 – SHOW THE FORCE TRADE HANDLER
──────────────────────────

Now I want to see the ACTUAL force trade code in the backend.

1. In `commands.py`, locate the handler that is called when I send "Force trade test on ETH/USD".

- Paste the FULL function, e.g. `cmd_force_trade_test()` or whatever you named it.
- Also show the relevant portion of `handle()` where it routes the text `"Force trade test on ETH/USD"` to that handler.

2. For that handler, explain:

- How it:
  - Parses the symbol from the text (e.g. ETH/USD)
  - Checks `ENABLE_FORCE_TRADE`
  - Checks current mode (live vs paper)
  - Computes quantity/notional for the test
  - Calls into ANY function that should eventually place orders on Kraken

3. Show the exact call you expect to be used to place the test trade, e.g.:

- `bracket_order_manager.open_position_with_brackets(...)`
- or `exchange.create_market_buy_order(...)`
- or some wrapper that leads to those

Paste the code where that call happens.

If the handler NEVER actually calls into bracket_order_manager / exchange to place an order, explicitly say so.

───────────────────────────────
STEP 3 – FOLLOW THE CALL CHAIN TO KRAKEN
───────────────────────────────

I want the precise call chain for the force trade test, from handler to Kraken:

List in order, with file + function, like:

1) [commands.py] cmd_force_trade_test(...) – parses command and prepares test
2) [commands.py or other] some_helper(...) – computes quantity, etc.
3) [bracket_order_manager.py] open_position_with_brackets(...)
4) [paper_exchange_wrapper.py or exchange_manager] create_market_buy_order(...)
5) [ccxt.kraken] actual HTTP request

For each step:
- Paste the core function body
- Show which `exchange` object it uses (PaperExchangeWrapper vs real ccxt exchange)
- Show how it decides mode (paper vs live)

Then answer explicitly:

- In the force trade path, is `exchange` the same object used for normal LIVE trades (i.e., PaperExchangeWrapper with _is_paper=False, pointing to real ccxt.kraken)?
- Or is it accidentally using:
  - a paper simulator, or
  - a dry-run / validate mode client?

──────────────────────────────
STEP 4 – WHAT ACTUALLY HAPPENED ON THE LAST RUN
──────────────────────────────

I want you to investigate the LAST time I ran "Force trade test on ETH/USD" with ENABLE_FORCE_TRADE=1.

Use whatever logs you have (evaluation_log, safety logs, bracket logs, etc.), and answer:

1. Did the force trade handler even RUN?
   - Show any log lines that clearly indicate:
       - "force trade test" started,
       - symbol: ETH/USD,
       - mode: live / paper,
       - and any internal IDs.

2. Did any code call:
   - `exchange.create_market_buy_order("ETH/USD", ...)`
   - OR `open_position_with_brackets(exchange, "ETH/USD", ...)`
   - during that attempt?

If yes:
- Show the logs or code paths that confirm the call, and any exception that came back from Kraken.

If no:
- Explicitly state: "On the last force trade attempt, no call to create_market_buy_order or open_position_with_brackets was made."

3. If there was an exception from Kraken (min size, invalid symbol, etc.), show:
   - The raw error message,
   - Where it was caught,
   - How it was turned into the vague “I cannot confirm the execution status” message.

──────────────────────────────
STEP 5 – DIAGNOSE THE REAL ROOT CAUSE
──────────────────────────────

Based ONLY on the actual code and logs (not guesses):

1. Why did the force trade test on ETH/USD result in:
   - No order on Kraken,
   - And the vague message: "I cannot confirm the execution status. Please verify your open orders"?

2. I want the SINGLE most likely root cause, phrased clearly, e.g.:

   - "The force trade handler never calls open_position_with_brackets; it currently only simulates a response."
   - "The force trade handler uses a paper exchange object even when mode is live."
   - "A Kraken error (X) is caught and thrown away, replaced with the generic 'cannot confirm' message."

3. Next, give me a **minimal fix plan** for BUILD mode that ONLY affects the force trade path:

- File(s) and function(s) to change
- The concrete changes needed, for example:
  - Always call open_position_with_brackets when ENABLE_FORCE_TRADE=1 and mode is LIVE.
  - If Kraken returns an error, return that error directly to the user instead of hiding it behind “cannot confirm”.
  - Ensure the force trade path uses the LIVE exchange client (PaperExchangeWrapper with is_paper=False), not a simulator.

Do NOT make any changes yet.  
I only want: actual code, actual logs, and a precise diagnosis + fix plan for the force trade path.